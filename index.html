<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Guia Interativo — Parques de MG (Protótipo Social)</title>
  <meta name="description" content="Protótipo mobile-first: guia + rede social leve para parques estaduais de Minas Gerais. Check-ins, carimbos, perfis e formulários.">
  <style>
    :root{--bg1:#f6fbff;--accent:#0b6b9a;--accent-2:#17a589;--card:#ffffff;--muted:#55636b}
    /* Mobile-first */
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial; margin:0; background:linear-gradient(180deg,var(--bg1),#ffffff); color:#0f2933}
    .wrap{max-width:980px;margin:0 auto;padding:14px}

    header{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:18px}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    /* top bar */
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-top:12px}
    .search{flex:1;margin:0 12px;display:flex;gap:8px}
    .search input{flex:1;padding:10px 12px;border-radius:12px;border:1px solid rgba(11,107,154,0.12);background:#fff}
    .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:12px;border:0;font-weight:700;cursor:pointer}
    .ghost{background:transparent;border:1px solid var(--accent);color:var(--accent)}

    /* map */
    .map-card{margin-top:12px;border-radius:14px;overflow:hidden;background:var(--card);box-shadow:0 10px 30px rgba(15,41,51,0.06)}
    .map-iframe{width:100%;height:280px;border:0}
    .map-actions{display:flex;gap:8px;padding:10px}
    .small{font-size:12px;color:var(--muted)}

    /* parks grid */
    .parks{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
    .card{background:var(--card);border-radius:14px;padding:10px;display:flex;gap:10px;align-items:flex-start;box-shadow:0 6px 18px rgba(11,107,154,0.06)}
    .thumb{width:110px;height:78px;border-radius:10px;overflow:hidden;flex:0 0 110px}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .meta h3{margin:0;font-size:15px;color:var(--accent)}
    .meta p{margin:6px 0 0 0;font-size:13px;color:var(--muted)}
    .card .actions{margin-left:auto;display:flex;flex-direction:column;gap:8px}

    /* FAB style profile */\    
    .profile-pill{display:flex;align-items:center;gap:10px;background:linear-gradient(90deg,#e9f8f6,#eef8ff);padding:8px;border-radius:999px}
    .avatar{width:44px;height:44px;border-radius:999px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}

    /* modal sheet */
    .modal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;padding:18px;z-index:60}
    .modal.open{display:flex}
    .sheet{width:100%;max-width:920px;border-radius:14px 14px 8px 8px;background:#fff;padding:14px;box-shadow:0 30px 60px rgba(0,0,0,0.18);max-height:92vh;overflow:auto}
    .sheet .head{display:flex;align-items:center;gap:12px}
    .hero{width:100%;height:220px;object-fit:cover;border-radius:10px;margin:10px 0}
    .gallery{display:flex;gap:8px;overflow:auto;padding-bottom:6px}
    .gallery img{height:86px;border-radius:8px;object-fit:cover}

    .stamp-preview{display:flex;flex-direction:column;align-items:center;padding:8px;border-radius:10px;background:linear-gradient(180deg,#fff,#f8fffb);width:120px}
    .stamp-preview .badge{width:78px;height:78px;border-radius:12px;background:#f2fbf9;display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent)}

    /* small screens */\    
    @media(min-width:880px){
      .parks{grid-template-columns:repeat(2,1fr)}
      .map-iframe{height:420px}
      .modal{align-items:center}
      .sheet{border-radius:14px;padding:20px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">MG</div>
      <div>
        <h1>Guia Interativo — Parques Estaduais de MG</h1>
        <p class="lead">Guia confiável + rede social leve — check-ins, carimbos e relatos. Protótipo.</p>
      </div>

      <div style="margin-left:auto">
        <div id="profileBtn" class="profile-pill" style="cursor:pointer" onclick="openProfile()">
          <div id="avatarEl" class="avatar">👣</div>
          <div style="font-size:13px"><strong id="profileName">Visitante</strong><br><span class="small" id="profileCity">—</span></div>
        </div>
      </div>
    </header>

    <div class="topbar">
      <div class="search">
        <input id="q" placeholder="Buscar parque ou cidade (ex: Ibitipoca)" />
        <button class="btn" id="btnSearch">Buscar</button>
      </div>
    </div>

    <div class="map-card">
      <!-- Default map centered on Minas Gerais. Replace src dynamically with your MyMaps embed when ready. -->
      <iframe id="mapFrame" class="map-iframe" src="https://maps.google.com/maps?q=Minas%20Gerais%2C%20Brazil&output=embed" allowfullscreen></iframe>
      <div class="map-actions">
        <div style="flex:1"><small class="small">Mapa: Minas Gerais (clique em um parque na lista para ver detalhes)</small></div>
        <button class="ghost" id="useMyMapsBtn">Usar My Maps</button>
      </div>
    </div>

    <section>
      <h2 style="margin:10px 0">Parques Estaduais (exemplos)</h2>
      <div id="parksList" class="parks"></div>
    </section>

    <footer style="margin:18px 0 50px 0;text-align:center;color:var(--muted)">Protótipo — sem backend (localStorage) • Para integração real com Google Forms e My Maps substitua os IDs nos lugares indicados.</footer>
  </div>

  <!-- Profile Modal -->
  <div id="modalProfile" class="modal">
    <div class="sheet">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>Seu Perfil</h3>
        <button class="ghost" onclick="closeProfile()">Fechar</button>
      </div>
      <p class="small">Nome, cidade e avatar ficam salvos no seu navegador (localStorage). Para levar seu perfil a outro dispositivo, use o botão Exportar / Importar.</p>
      <div style="display:flex;gap:12px;align-items:center;margin-top:10px">
        <div style="width:84px;height:84px;border-radius:12px;background:#f2fbf9;display:flex;align-items:center;justify-content:center;font-size:34px" id="pfAvatarBig">👣</div>
        <div style="flex:1">
          <input id="pfName" placeholder="Seu apelido (ex: Ana Exploradora)" style="width:100%;padding:10px;border-radius:10px;border:1px solid #eee" />
          <input id="pfCity" placeholder="Cidade (opcional)" style="width:100%;padding:10px;border-radius:10px;border:1px solid #eee;margin-top:8px" />
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" onclick="saveProfile()">Salvar</button>
            <button class="ghost" onclick="pickRandomAvatar()">Avatar aleatório</button>
            <button class="ghost" onclick="exportProfile()">Exportar</button>
            <button class="ghost" onclick="importProfile()">Importar</button>
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <small class="small">Dica: ao gerar carimbos no parque, seu apelido e avatar serão usados no texto do carimbo.</small>
      </div>
    </div>
  </div>

  <!-- Park detail modal -->
  <div id="modalPark" class="modal">
    <div class="sheet">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h3 id="parkTitle">Título do Parque</h3>
          <div id="parkMeta" class="small">Cidade • Dificuldade • Tempo</div>
        </div>
        <div><button class="ghost" onclick="closePark()">Fechar</button></div>
      </div>

      <img id="parkHero" class="hero" src="" alt="">

      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <h4>Sobre</h4>
          <p id="parkAbout" class="small">Descrição do parque.</p>

          <h4>Galeria</h4>
          <div id="parkGallery" class="gallery"></div>

          <h4 style="margin-top:10px">Compartilhe sua experiência (Formulário)</h4>
          <div style="height:420px;overflow:auto;border-radius:10px;border:1px solid #eee;padding:6px">
            <!-- Substitua o src abaixo pelo seu Google Form do parque -->
            <iframe id="parkForm" src="https://docs.google.com/forms/d/e/SEU_FORM_ID/viewform?embedded=true" style="width:100%;height:100%;border:0" title="Formulário do Parque">Carregando…</iframe>
          </div>
        </div>

        <aside style="width:260px">
          <h4>Interaja</h4>
          <div style="margin-top:6px">
            <p class="small">Fazer check-in gera um carimbo (imagem) personalizado com seu apelido e avatar. Você pode baixar e compartilhar.</p>
            <input type="file" id="photoInput" accept="image/*" style="width:100%;margin-top:8px" />
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="btnGenerate">Gerar carimbo</button>
              <button class="ghost" id="btnQuick">Quick</button>
            </div>

            <div style="margin-top:12px">
              <div class="stamp-preview" id="stampPreview">
                <div class="badge" id="stampBadge">MG</div>
                <small id="stampLabel">Sem check-in</small>
              </div>
            </div>

            <div style="margin-top:12px">
              <h5>Seus carimbos</h5>
              <div id="myStamps"></div>
            </div>
          </div>
        </aside>
      </div>

    </div>
  </div>

  <canvas id="canvas" style="display:none"></canvas>

  <script>
    // ---------- SAMPLE DATA (replace/expand later) ----------
    const parks = [
      {id:'ibitipoca',name:'Parque Estadual do Ibitipoca',city:'Lima Duarte - MG',difficulty:'Médio',time:'4-6h',hero:'https://upload.wikimedia.org/wikipedia/commons/e/eb/Janela_do_C%C3%A9u_-_Parque_Estadual_do_Ibitipoca.jpg',about:'Área de preservação com trilhas, mirantes e cachoeiras. Traga água, calçado adequado e respeite as regras do parque.',gallery:['https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=800','https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=800']},
      {id:'cipo',name:'Parque Estadual da Serra do Cipó',city:'Serra do Cipó - MG',difficulty:'Fácil a Difícil',time:'2-8h',hero:'https://upload.wikimedia.org/wikipedia/commons/c/cc/Parque_Nacional_da_Serra_do_Cip%C3%B3.jpg',about:'Cachoeiras, fauna e flora riquíssimas. Perfeito para trilhas e escaladas leves.',gallery:['https://images.unsplash.com/photo-1499394153797-499f5d8f2b51?q=80&w=800']}
    ];

    // ---------- UI RENDER ----------
    const parksList = document.getElementById('parksList');
    function renderList(items){
      parksList.innerHTML='';
      items.forEach(p=>{
        const el = document.createElement('article'); el.className='card';
        el.innerHTML = `
          <div class="thumb"><img src="${p.hero}" alt></div>
          <div class="meta">
            <h3>${p.name}</h3>
            <p>${p.city} • ${p.time} • ${p.difficulty}</p>
            <p class="small" style="margin-top:8px">Clique para ver detalhes, formar relatos e gerar carimbos.</p>
          </div>
          <div class="actions"><button class="btn" data-id="${p.id}">Abrir</button></div>
        `;
        parksList.appendChild(el);
      });
      document.querySelectorAll('.card .btn').forEach(b=>b.addEventListener('click',e=>openPark(e.target.dataset.id)));
    }

    renderList(parks);

    // ---------- Profile handling (localStorage) ----------
    const defaultProfile = {name:'Visitante',city:'',avatar:'👣'};
    function loadProfile(){
      const raw = localStorage.getItem('explorerProfile');
      if(raw) try{ return JSON.parse(raw) }catch(e){}
      return defaultProfile;
    }
    function saveProfileObj(profile){ localStorage.setItem('explorerProfile',JSON.stringify(profile)); applyProfile(); }
    function applyProfile(){ const p=loadProfile(); document.getElementById('profileName').textContent=p.name||'Visitante'; document.getElementById('profileCity').textContent=p.city||'—'; document.getElementById('avatarEl').textContent=p.avatar||'👣'; document.getElementById('pfAvatarBig').textContent=p.avatar||'👣'; document.getElementById('stampBadge').textContent=p.avatar||'MG'; }
    applyProfile();

    function openProfile(){
      const m=document.getElementById('modalProfile'); m.classList.add('open');
      const p = loadProfile(); document.getElementById('pfName').value = p.name!=='Visitante'?p.name:''; document.getElementById('pfCity').value = p.city||''; document.getElementById('pfAvatarBig').textContent = p.avatar||'👣';
    }
    function closeProfile(){ document.getElementById('modalProfile').classList.remove('open'); }
    function saveProfile(){
      const name = document.getElementById('pfName').value.trim() || 'Visitante';
      const city = document.getElementById('pfCity').value.trim() || '';
      const avatar = document.getElementById('pfAvatarBig').textContent || '👣';
      saveProfileObj({name,city,avatar}); closeProfile();
    }
    function pickRandomAvatar(){ const avs=['🌿','🪵','🏞️','🦋','🐦','🌄','👣','✨']; const a=avs[Math.floor(Math.random()*avs.length)]; document.getElementById('pfAvatarBig').textContent=a; }
    function exportProfile(){ const p=localStorage.getItem('explorerProfile'); if(!p) return alert('Sem perfil salvo ainda.'); const blob=new Blob([p],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='perfil-explorador.json'; a.click(); }
    function importProfile(){ const inp=document.createElement('input'); inp.type='file'; inp.accept='.json'; inp.onchange=e=>{ const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ const obj=JSON.parse(r.result); saveProfileObj(obj); alert('Perfil importado.'); closeProfile(); }catch(err){alert('Arquivo inválido.')}}; r.readAsText(f); }; inp.click(); }

    // ---------- Park modal & interactions ----------
    let currentPark=null;
    function openPark(id){
      const p = parks.find(x=>x.id===id); if(!p) return;
      currentPark=p; document.getElementById('parkTitle').textContent=p.name; document.getElementById('parkMeta').textContent=p.city + ' • ' + p.difficulty + ' • ' + p.time; document.getElementById('parkAbout').textContent=p.about; document.getElementById('parkHero').src=p.hero;
      const g=document.getElementById('parkGallery'); g.innerHTML=''; (p.gallery||[]).forEach(u=>{ const im=document.createElement('img'); im.src=u; g.appendChild(im); });
      // set form src placeholder (replace with per-park form IDs later)
      // document.getElementById('parkForm').src = 'https://docs.google.com/forms/d/e/SEU_FORM_ID_'+p.id+'/viewform?embedded=true';
      document.getElementById('modalPark').classList.add('open');
      refreshMyStamps();
    }
    function closePark(){ document.getElementById('modalPark').classList.remove('open'); }

    // ---------- Stamp generation (canvas) ----------
    const canvas = document.getElementById('canvas'); const ctx = canvas.getContext('2d');
    document.getElementById('btnGenerate').addEventListener('click', ()=> generateStamp(false));
    document.getElementById('btnQuick').addEventListener('click', ()=> generateStamp(true));

    function generateStamp(quick){
      if(!currentPark) return alert('Abra um parque antes.');
      const profile = loadProfile();
      const file = document.getElementById('photoInput').files[0];
      const img = new Image(); img.crossOrigin='anonymous'; img.onload = ()=>{
        // canvas size
        canvas.width = 1200; canvas.height = 800; ctx.fillStyle='#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
        // draw cover with crop
        const ratio = Math.max(canvas.width/img.width, canvas.height/img.height);
        const w = img.width * ratio, h = img.height * ratio; const x = (canvas.width-w)/2, y=(canvas.height-h)/2;
        ctx.drawImage(img,x,y,w,h);
        // overlay bottom band
        ctx.fillStyle='rgba(0,0,0,0.36)'; ctx.fillRect(0,canvas.height-160,canvas.width,160);
        // park name
        ctx.fillStyle='#fff'; ctx.font='700 46px sans-serif'; ctx.textAlign='left'; ctx.fillText(currentPark.name,40,canvas.height-78);
        ctx.font='20px sans-serif'; ctx.fillText(currentPark.city+' • '+currentPark.time,40,canvas.height-46);
        // avatar circle
        const cx = canvas.width - 120, cy = canvas.height - 80, r = 64;
        ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,0.95)'; ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill(); ctx.closePath();
        // avatar as text
        ctx.fillStyle='#0b6b9a'; ctx.font='700 38px sans-serif'; ctx.textAlign='center'; ctx.fillText(profile.avatar||'👣',cx,cy+12);
        // small credit
        ctx.font='600 18px sans-serif'; ctx.fillText(profile.name||'Visitante',cx,canvas.height-22);

        // create blob
        canvas.toBlob(blob=>{
          const url = URL.createObjectURL(blob);
          const stamps = JSON.parse(localStorage.getItem('explorerStamps')||'[]');
          const entry = {id:Date.now(),parkId:currentPark.id,parkName:currentPark.name,ts:new Date().toISOString(),url};
          stamps.push(entry); localStorage.setItem('explorerStamps',JSON.stringify(stamps));
          refreshMyStamps();
          // auto-download
          const a=document.createElement('a'); a.href=url; a.download=currentPark.id+'-stamp.png'; a.click();
          // try navigator.share
          if(navigator.share){ fetch(url).then(r=>r.blob()).then(b=>{ const f = new File([b], currentPark.id+'-stamp.png',{type:'image/png'}); navigator.share({files:[f],title:'Check-in: '+currentPark.name,text:profile.name+' no '+currentPark.name}).catch(()=>{}); }); }
        });
      };
      // load input image or hero fallback
      if(quick){ img.src = currentPark.hero; }
      else if(file){ img.src = URL.createObjectURL(file); }
      else { img.src = currentPark.hero; }
    }

    function refreshMyStamps(){
      const container = document.getElementById('myStamps'); container.innerHTML='';
      const stamps = JSON.parse(localStorage.getItem('explorerStamps')||'[]').slice().reverse();
      stamps.forEach(s=>{
        const d=document.createElement('div'); d.style.display='flex'; d.style.alignItems='center'; d.style.gap='8px'; d.style.marginBottom='8px';
        const im=document.createElement('img'); im.src=s.url; im.style.width='72px'; im.style.height='54px'; im.style.objectFit='cover'; im.style.borderRadius='8px';
        const meta=document.createElement('div'); meta.style.fontSize='13px'; meta.innerHTML=`<strong>${s.parkName}</strong><br><small>${new Date(s.ts).toLocaleString()}</small>`;
        const btn=document.createElement('button'); btn.className='ghost'; btn.textContent='Remover'; btn.onclick=()=>{ removeStamp(s.id); };
        d.appendChild(im); d.appendChild(meta); d.appendChild(btn); container.appendChild(d);
      });
    }
    function removeStamp(id){ let arr=JSON.parse(localStorage.getItem('explorerStamps')||'[]'); arr=arr.filter(x=>x.id!==id); localStorage.setItem('explorerStamps',JSON.stringify(arr)); refreshMyStamps(); }

    // ---------- Search ----------
    document.getElementById('btnSearch').addEventListener('click', ()=>{ const q=document.getElementById('q').value.toLowerCase().trim(); if(!q) return renderList(parks); renderList(parks.filter(p=>p.name.toLowerCase().includes(q)||p.city.toLowerCase().includes(q))); });

    // ---------- MyMaps button (replace map src) ----------
    document.getElementById('useMyMapsBtn').addEventListener('click', ()=>{
      const url = prompt('Cole aqui o link de incorporação (iframe) do seu Google My Maps:\n(Ex: https://www.google.com/maps/d/embed?mid=SEU_ID)');
      if(url){ document.getElementById('mapFrame').src = url; }
    });

    // ---------- init ----------
    (function(){ if(!localStorage.getItem('explorerProfile')) saveProfileObj(defaultProfile); applyProfile(); refreshMyStamps(); })();
  </script>
</body>
</html>
